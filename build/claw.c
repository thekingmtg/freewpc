
/* This file was autogenerated by 'ctemp' from  for class duty. */


#include <freewpc.h>
#include "claw.h"

__fastram__ claw_state_t claw_state;
__fastram__ U8 claw_timer;
claw_location_t claw_location;
U8 claw_speed;


void claw_go_left (void) {
	disable_interrupts ();
	claw_timer = 1;
	claw_state = CLAW_FORWARD;
	claw_location = CLAW_UNKNOWN;
	sol_disable (SOL_CLAW_RIGHT);
	enable_interrupts ();
}



void claw_go_right (void) {
	disable_interrupts ();
	claw_timer = 1;
	claw_state = CLAW_REVERSE;
	claw_location = CLAW_UNKNOWN;
	sol_disable (SOL_CLAW_LEFT);
	enable_interrupts ();
}


void claw_go_to_center_monitor (void) {
	task_sleep(TIME_500MS);
	task_sleep(TIME_100MS);
	disable_interrupts ();
	claw_state = CLAW_IDLE;
	sol_disable (SOL_CLAW_RIGHT);
	sol_disable (SOL_CLAW_LEFT);
	enable_interrupts ();
	task_exit ();
}

void claw_go_left_to_center (void) {
	disable_interrupts ();
	claw_timer = 1;
	claw_state = CLAW_FORWARD;
	claw_location = CLAW_UNKNOWN;
	task_create_gid1 (GID_CLAW_GRTC_MONITOR, claw_go_to_center_monitor);
	enable_interrupts ();
}


void claw_go_right_to_center (void) {
	disable_interrupts ();
	claw_timer = 1;
	claw_state = CLAW_REVERSE;
	claw_location = CLAW_UNKNOWN;
	task_create_gid1 (GID_CLAW_GRTC_MONITOR, claw_go_to_center_monitor);
	enable_interrupts ();
}


void claw_stop (void) {
	disable_interrupts ();
	claw_stop_from_interrupt ();
	enable_interrupts ();
	claw_state = CLAW_IDLE;
	sol_disable (SOL_CLAW_RIGHT);
	sol_disable (SOL_CLAW_LEFT);
}



CALLSET_ENTRY (claw, SW_CLAW_POSITION_1) {
	if (!(claw_location == CLAW_LEFT) ) {
			claw_stop (); 
			claw_location = CLAW_LEFT;
	}
}



CALLSET_ENTRY (claw, SW_CLAW_POSITION_2) {
	claw_stop (); 
	claw_location = CLAW_RIGHT;
}


void claw_bump_monitor (void) {
	task_sleep(TIME_100MS);
	claw_stop (); 
	task_exit ();
}


void claw_bump_left (void) {
	if ( 	(claw_location == CLAW_UNKNOWN)
		|| 	(claw_location == CLAW_RIGHT) ){ 
				disable_interrupts ();
				claw_timer = 1;
				claw_state = CLAW_FORWARD;
				claw_location = CLAW_UNKNOWN;
				sol_disable (SOL_CLAW_RIGHT);
				sol_enable (SOL_CLAW_LEFT);
				task_recreate_gid (GID_CLAW_B_MONITOR, claw_bump_monitor);
				enable_interrupts ();
	}
}



void claw_bump_right (void) {
	if ( 	(claw_location == CLAW_UNKNOWN)
		|| 	(claw_location == CLAW_LEFT) ){ 
				disable_interrupts ();
				claw_timer = 1;
				claw_state = CLAW_REVERSE;
				claw_location = CLAW_UNKNOWN;
				sol_disable (SOL_CLAW_LEFT);
				sol_enable (SOL_CLAW_RIGHT);
				task_recreate_gid (GID_CLAW_B_MONITOR, claw_bump_monitor);
				enable_interrupts ();
	}
}


CALLSET_ENTRY (claw, init) {
	claw_state = CLAW_IDLE;
	claw_location = CLAW_UNKNOWN;
	claw_set_speed (CLAW_DUTY_100);
}




CALLSET_ENTRY (claw, tilt, stop_game, test_start) {
	claw_state = CLAW_IDLE;
	claw_location = CLAW_UNKNOWN;
	claw_stop ();
}



/* vim: set filetype=c: */



